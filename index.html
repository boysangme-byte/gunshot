<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <title>악령사냥</title>
  <style>
    :root { --bg:#0a0014; --panel:#150b2c; --line:#3a2360; --text:#e9d7ff; --accent:#d080ff; --danger:#ff4fa0; --good:#73ffdf; }
    *{ box-sizing:border-box; }
    body { margin:0; background: radial-gradient(900px 600px at 70% 20%, #1a0038, var(--bg)); color:var(--text);
           font-family: "Noto Sans KR", system-ui, sans-serif; display:grid; place-items:center; height:100vh; }
    #game { width:100%; max-width:960px; aspect-ratio:16/9; border:2px solid var(--line); border-radius:12px;
            background:#000; display:block; touch-action:none; }
    .hud { display:flex; gap:12px; margin-top:6px; font-size:14px; }
    .hud div { background:rgba(255,255,255,0.05); border:1px solid var(--line); padding:6px 10px; border-radius:8px; }
    .title { font-weight:900; font-size:20px; margin-bottom:8px; color:var(--accent); text-shadow:0 0 8px var(--accent); }
    .controls { font-size:13px; opacity:.8; margin-top:4px; }
  </style>
</head>
<body>
  <div>
    <div class="title">🎮 악령사냥</div>
    <canvas id="game"></canvas>
    <div class="hud">
      <div>점수: <span id="score">0</span></div>
      <div>무기: <span id="weapon">Pistol</span></div>
      <div>체력: <span id="hp">5</span></div>
      <div>보스: <span id="boss">-</span></div>
      <div>상태: <span id="status">Survive</span></div>
    </div>
    <div class="controls">WASD 이동 · 마우스 조준/클릭 발사 · Shift 대시 · 무기 1/2/3 전환</div>
  </div>

<script>
(() => {
  const canvas=document.getElementById("game"), ctx=canvas.getContext("2d");
  const ui={score:document.getElementById("score"), weapon:document.getElementById("weapon"),
            hp:document.getElementById("hp"), boss:document.getElementById("boss"), status:document.getElementById("status")};
  function resize(){const r=canvas.getBoundingClientRect(); canvas.width=r.width; canvas.height=r.height;}
  new ResizeObserver(resize).observe(canvas);

  // Load images
  const imgPlayer=new Image(); imgPlayer.src="player.png";
  const imgEnemy=new Image(); imgEnemy.src="enemy.png";
  const imgBoss=new Image(); imgBoss.src="boss.png";
  const imgHeal=new Image(); imgHeal.src="heal.png";

  const keys=new Set(); const mouse={x:0,y:0,down:false};
  window.addEventListener("keydown",e=>{keys.add(e.key.toLowerCase());});
  window.addEventListener("keyup",e=>{keys.delete(e.key.toLowerCase());});
  canvas.addEventListener("mousedown",()=>mouse.down=true);
  window.addEventListener("mouseup",()=>mouse.down=false);
  canvas.addEventListener("mousemove",e=>{const r=canvas.getBoundingClientRect(); mouse.x=e.clientX-r.left; mouse.y=e.clientY-r.top;});

  const state={w:0,h:0,score:0,hp:5,weapon:"pistol",wave:1,boss:null,over:false,time:0,laserTimer:0,heals:[]};
  let player={x:300,y:300,r:20,speed:220,fireCd:0};

  const bullets=[], enemies=[];
  class Enemy{constructor(x,y){this.x=x;this.y=y;this.r=18;this.spd=60;this.hp=1;this.dead=false;}
    update(dt){const a=Math.atan2(player.y-this.y,player.x-this.x);this.x+=Math.cos(a)*this.spd*dt;this.y+=Math.sin(a)*this.spd*dt;
      if(Math.hypot(this.x-player.x,this.y-player.y)<this.r+player.r){ hitPlayer(); this.dead=true; }}
    draw(){ctx.drawImage(imgEnemy,this.x-this.r,this.y-this.r,this.r*2,this.r*2);}}
  class Boss{constructor(){this.x=canvas.width/2;this.y=60;this.r=40;this.hp=60;this.dead=false;}
    update(dt){const a=Math.atan2(player.y-this.y,player.x-this.x);this.x+=Math.cos(a)*40*dt;this.y+=Math.sin(a)*40*dt;
      if(Math.hypot(this.x-player.x,this.y-player.y)<this.r+player.r){ hitPlayer(2); }}
    draw(){ctx.drawImage(imgBoss,this.x-this.r,this.y-this.r,this.r*2,this.r*2);
      ctx.fillStyle="#f0f"; ctx.fillRect(this.x-40,this.y+this.r+8,80*(this.hp/60),6);}}
  class Bullet{constructor(x,y,a,speed,dmg=1){this.x=x;this.y=y;this.r=4;this.vx=Math.cos(a)*speed;this.vy=Math.sin(a)*speed;this.dmg=dmg;this.dead=false;}
    update(dt){this.x+=this.vx*dt;this.y+=this.vy*dt; if(this.x<0||this.y<0||this.x>canvas.width||this.y>canvas.height) this.dead=true;}
    draw(){ctx.fillStyle="#73ffdf";ctx.beginPath();ctx.arc(this.x,this.y,this.r,0,Math.PI*2);ctx.fill();}}
  class Heal{constructor(x,y){this.x=x;this.y=y;this.r=18;this.dead=false;}
    draw(){ctx.drawImage(imgHeal,this.x-this.r,this.y-this.r,this.r*2,this.r*2);}}

  function hitPlayer(dmg=1){state.hp-=dmg; ui.hp.textContent=state.hp; if(state.hp<=0) state.over=true;}
  function fire(){if(state.weapon==="pistol"){spawnBullet(1,520);} else if(state.weapon==="shotgun"){for(let i=0;i<5;i++){spawnBullet(1,480,(Math.random()-0.5)*0.3);}}
    else if(state.weapon==="laser"){ state.laserTimer=0.25; dealLaser(); }}
  function spawnBullet(dmg,speed,spread=0){const a=Math.atan2(mouse.y-player.y,mouse.x-player.x)+spread; bullets.push(new Bullet(player.x,player.y,a,speed,dmg));}
  function dealLaser(){if(state.boss&&!state.boss.dead&&Math.hypot(state.boss.x-player.x,state.boss.y-player.y)<600){state.boss.hp-=2;if(state.boss.hp<=0){state.boss.dead=true;state.score+=500;}} enemies.forEach(e=>{if(Math.hypot(e.x-player.x,e.y-player.y)<600){e.dead=true;state.score+=10;}});}

  function update(dt){state.time+=dt;
    // spawn enemies
    if(Math.random()<0.02) enemies.push(new Enemy(Math.random()*canvas.width,Math.random()*canvas.height));
    enemies.forEach(e=>e.update(dt));
    bullets.forEach(b=>b.update(dt));
    enemies.forEach(e=>{bullets.forEach(b=>{if(!e.dead&&!b.dead&&Math.hypot(e.x-b.x,e.y-b.y)<e.r+b.r){e.dead=true;b.dead=true;state.score+=10;}});});
    if(state.boss){state.boss.update(dt); bullets.forEach(b=>{if(!b.dead&&Math.hypot(b.x-state.boss.x,b.y-state.boss.y)<state.boss.r+b.r){b.dead=true;state.boss.hp-=1;if(state.boss.hp<=0){state.boss.dead=true;state.score+=500;}}}); if(state.boss.dead){state.boss=null; state.wave++;}}
    if(state.score>=500*state.wave && !state.boss){state.boss=new Boss(); ui.boss.textContent="나옴";}
    // heals
    if(Math.random()<0.001) state.heals.push(new Heal(Math.random()*canvas.width,Math.random()*canvas.height));
    state.heals.forEach(h=>{if(Math.hypot(h.x-player.x,h.y-player.y)<h.r+player.r){state.hp++;ui.hp.textContent=state.hp;h.dead=true;}});
    state.heals=state.heals.filter(h=>!h.dead);

    // player move
    let dx=(keys.has("d")?1:0)-(keys.has("a")?1:0); let dy=(keys.has("s")?1:0)-(keys.has("w")?1:0);
    const len=Math.hypot(dx,dy)||1; player.x+=dx/len*player.speed*dt; player.y+=dy/len*player.speed*dt;
    player.x=Math.max(player.r,Math.min(canvas.width-player.r,player.x)); player.y=Math.max(player.r,Math.min(canvas.height-player.r,player.y));
    if(mouse.down){player.fireCd-=dt; if(player.fireCd<=0){fire(); player.fireCd=state.weapon==="shotgun"?0.35:0.18;}}
    if(state.score>=100) state.weapon="shotgun"; if(state.score>=250) state.weapon="laser"; ui.weapon.textContent=state.weapon;
    ui.score.textContent=state.score; if(state.boss&&!state.boss.dead) ui.boss.textContent="활성"; else ui.boss.textContent="-";
    if(state.laserTimer>0){state.laserTimer-=dt; dealLaser();}
  }

  function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);
    enemies.forEach(e=>e.draw()); if(state.boss&&!state.boss.dead) state.boss.draw(); bullets.forEach(b=>b.draw()); state.heals.forEach(h=>h.draw());
    ctx.drawImage(imgPlayer,player.x-player.r,player.y-player.r,player.r*2,player.r*2);
    if(state.laserTimer>0){ctx.strokeStyle="#d080ff"; ctx.shadowColor="#d080ff"; ctx.shadowBlur=12; ctx.lineWidth=6; ctx.beginPath(); ctx.moveTo(player.x,player.y); ctx.lineTo(mouse.x,mouse.y); ctx.stroke(); ctx.shadowBlur=0;}
  }

  let last=0; function loop(t){const dt=(t-last)/1000; last=t; if(!state.over){update(dt);} draw(); requestAnimationFrame(loop);} requestAnimationFrame(loop);
})();
</script>
</body>
</html>
